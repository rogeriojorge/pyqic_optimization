from qic import Qic
from qic.calculate_r2 import evaluate_X2c_X2s_QI
def optimized_configuration_nfp1(nphi=151,order = "r3"):
    rc      = [1.0,0.0,-0.39106484609133596,0.0,0.07420532171851724,0.0,-0.008274763209678735,0.0,0.0,0.0,0.0,0.0,0.0]
    zs      = [0.0,0.0,-0.35402732877313414,0.0,0.07553168904121454,0.0,-0.009365141987646229,0.0,-1.9768670588022887e-05,0.0,-2.4413584509452786e-05,0.0,-4.355497827869058e-06]
    B0_vals = [1.0,0.18488934765044085]
    omn_method = "non-zone"
    k_buffer = 3
    p_buffer = 2
    d_over_curvature_cvals = []
    d_over_curvature_spline = [0.845052502001443,0.699425993150433,0.5499703357833479,0.5889257185968038,0.5502015334433132,0.5351479899703877]
    delta   = 0.1
    d_svals = []
    nfp     = 1
    iota    = -0.6920094424349212
    p2    = 0.0
    X2s_svals = []
    X2c_cvals = [0.0]
    X2s_cvals = [0.05881203495854033,-0.2539182773746816,-0.25512767663083175,0.21687406473480356,0.4655500549061221,0.7722108757539886,0.719181133576835,0.8430942190419811,0.8434191675750448,1.0322408421628075,0.8716728178251898,0.6140270794706528,0.042507777066401256,-0.39476181504588503,-0.8122127682711922,-0.9481190531392428,-1.0149988370090361,-0.8948194524988082,-0.7881034975051912,-0.602617872816953,-0.4820217960066482,-0.33343838512925295,-0.2573670030324856,-0.16593070069013813,-0.13548609099268566,-0.0885633401343605,-0.08836172421376562,-0.06873226063003092,-0.08452353526349915,-0.07963639933511969,-0.1024373524196534,-0.10523773035266895,-0.1306215706285098,-0.1378926693316969,-0.16404522903811855,-0.17421901472897514,-0.1998738590864146,-0.21110522198518702,-0.23400285460683248,-0.242980414010984,-0.25917158162212994,-0.2609169375835487,-0.2651591028729708,-0.25407064314540334,-0.24152389722061546,-0.21366038808622204,-0.18248709859496282,-0.1381310206237161,-0.09151147086410988,-0.036255454733454075,0.01775298326930797,0.07439661561728658,0.12529833803077833,0.17292137054608164,0.21087486951799067,0.24096508420071694,0.2592127940315983,0.26754706296765246,0.265287974869491,0.25564398802031185,0.241871599873475,0.2274018250620548,0.21486090215095782,0.20050539824939106,0.1805375311581493,0.15083491180399303,0.12123653891165743,0.10299800892915494,0.10039836574517366,0.09950657787009479,0.08766429734578442,0.06323540823562264,0.03603663809452253,0.014342041767211055,0.0020075374504246154,-0.002825330967071282,-0.000489288182666745,0.008640095855172846,0.027306827763190735,0.05296872326589332,0.07962073605386927,0.09623531028328879,0.09996831833542572,0.10077816041415404,0.11334804569595218,0.14124475359023628,0.1719792102673163,0.19575752880934455,0.21083230419745003,0.22345263001470608,0.23704771682813486,0.25109535721979975,0.26274982569222455,0.2671947369431787,0.263201447285418,0.24737527732784845,0.2222100600606004,0.18546749583965164,0.14232881517474097,0.09061479986218987,0.03752801258030525,-0.019774173396134114,-0.07244689893706593,-0.12488788769140263,-0.16710686474189337,-0.20619439961383387,-0.23134665549201475,-0.2532361008543864,-0.2599199785368505,-0.26597207054229277,-0.2573114216787165,-0.2523342336465468,-0.23355973237445277,-0.22315774243671335,-0.19919619995796337,-0.18785207196235373,-0.16206739177289112,-0.15253548641221265,-0.1267283565679974,-0.12058963856967186,-0.09600253146907109,-0.0951300149470065,-0.07421323500729116,-0.08285918509182795,-0.07138452414863149,-0.09829569467559178,-0.10707335883867289,-0.16666922679570853,-0.21126902380139437,-0.3209218914516652,-0.41428550627666,-0.5799592681556638,-0.7077717433992838,-0.887463181173578,-0.9607804005208957,-1.016367289984963,-0.8477221483018353,-0.591314777783598,-0.0744087092630881,0.3875494001808149,0.858608617309018,0.9543863533605261,0.9654630789987481,0.7836565033638545,0.807736951184123,0.7192921642556233,0.6362291471464889,0.26825521683438436,-0.07285854530886154,-0.32528060867234754,-0.11241512755593765]
    X2c_svals = [-1.4891734608362783,1.6535935887676088,0.9689867292480043,-0.584524120317808,-0.9728078570346281,-1.3146753581450454,-1.0292918939756972,-1.0362009182172418,-0.903933530944503,-0.9759530051459921,-0.7337446820012069,-0.4637263605455652,-0.029000093270742756,0.24488067848413306,0.46116019479622566,0.49622771326067777,0.4935392491559764,0.40780740619797967,0.3399906174788229,0.2488062461924201,0.19275182037582234,0.13077230036341211,0.10027246430087512,0.06503540653481193,0.05406147190164303,0.0363696037609544,0.03770438727403478,0.03072232388053349,0.03984032926346114,0.03979163970550367,0.05447714938262455,0.05974159011647483,0.07931481165477851,0.0896780936674517,0.11435138109293722,0.1302108100118904,0.16017181512067716,0.18134988593205498,0.215414481033773,0.2395916017066254,0.2736089034124751,0.29477103552829464,0.32043510710546014,0.32830290692004593,0.333606949054436,0.3153991361794272,0.28785957172689197,0.23283595303426322,0.1648519265663731,0.06981596853847133,-0.03655741425778376,-0.16390763323340488,-0.2955391832305403,-0.4370097851546876,-0.5715602189367114,-0.7012757603051256,-0.8111164175225042,-0.901611327729689,-0.9646150069551432,-1.005224074235799,-1.0312324060579474,-1.054590461904565,-1.0879577067192678,-1.1136103344580477,-1.105981821895113,-1.0262051591764134,-0.9239090602354887,-0.8887654704694073,-0.994766228010389,-1.1533144743969808,-1.2193676850653503,-1.0955331694724733,-0.8243215508096048,-0.48067913624545355,-0.12514829581545045,1.2336625140786648,-0.04271574380975651,0.3424385093187654,0.6987710856503383,0.9987214698155938,1.1857533197167267,1.1814254487392648,1.0412097332872303,0.9090322881375343,0.8991184155039287,0.9969441233061577,1.0901278861873345,1.1225952636627266,1.1003627043232054,1.066593017925798,1.038999381284484,1.0140109705471496,0.9803763538604336,0.9233245728811246,0.8440385857220356,0.7374242250430417,0.6166516753057032,0.479723691979559,0.3434877583311556,0.20421384848141438,0.07903381473753221,-0.038937377300352585,-0.1334376509612692,-0.2152241201980672,-0.2694908148005233,-0.31118637457170184,-0.3267134393271085,-0.334587956687795,-0.32120743069818863,-0.307318606541942,-0.2778671552597496,-0.2545541914903001,-0.22000000277967013,-0.19618297688148773,-0.16337575964139758,-0.14370281190019468,-0.1156263084848984,-0.10151594721993998,-0.07872240501777521,-0.06999687334382955,-0.0521636271305669,-0.04851257446753329,-0.03564890120184149,-0.03767282131011974,-0.030909644716254413,-0.040844714565405775,-0.04308638749290943,-0.06563159099994884,-0.08236308589711093,-0.12540795191256385,-0.16436362105324612,-0.2365895087916826,-0.3005176163438962,-0.39666414624441165,-0.45672367561057636,-0.5185820784862722,-0.4680499786148117,-0.3558765948004685,-0.04914405803390782,0.28272723975864666,0.6965192278157317,0.8672592278633005,0.9912485068735604,0.9188073207269118,1.0966101254764369,1.152428145061024,1.236291402983038,0.6594023791508137,-0.24340585568097,-1.707622792419528,-1.438142797369827]
    # B20QI_deviation_max = 0.1324268374296862
    # B2cQI_deviation_max = 2.2957946654855732e-10
    # B2sQI_deviation_max = 0.3026140975680799
    # Max |X20| = 1.1405201984166748
    # Max |Y20| = 1.7880818331581583
    # Max |Y2c| = 2.1969566999408388
    # Max |Y2s| = 1.6333723420776334
    # Min r_singularity = 0.2042727842449063
    # Max |X3c1| = 1.0575864534449535
    # Max |X3s1| = 3.006426557894831
    # Max |Y3c1| = 4.52645692619274
    # Max |Y3s1| = 0.46526031994032113
    # gradgradB inverse length: 9.12774947896786
    # d2_volume_d_psi2 = 223.64983907348088
    # max curvature_d(0) = 1.559662714491833
    # max d_d(0) = 1.317590121134738
    # max gradB inverse length: 1.526263733420192
    # Max elongation = 4.576231115982216
    # Initial objective = 3.3407045128836117
    # Final objective = 2.6281002092132577
    stel = Qic(omn_method = omn_method, delta=delta, p_buffer=p_buffer, p2=p2, k_buffer=k_buffer, rc=rc,zs=zs, nfp=nfp, B0_vals=B0_vals, d_svals=d_svals, nphi=nphi, omn=True, B2c_cvals=X2c_cvals, B2s_svals=X2s_svals, order=order, d_over_curvature_cvals=d_over_curvature_cvals, B2c_svals=X2c_svals, B2s_cvals=X2s_cvals, d_over_curvature_spline=d_over_curvature_spline)
    stel._set_names();stel.calculate()
    min_geo_qi_consistency = stel.min_geo_qi_consistency(order = 1);X2c, X2s = evaluate_X2c_X2s_QI(stel, X2s_in=0)
    stel.B2c_svals=X2c;stel.B2s_cvals=X2s;stel._set_names();stel.calculate()
    return stel